<app-okr-toolbar>
  <button (click)="navigateToCompanies()" class="navbar-item" mat-icon-button matTooltip="{{ 'user-management.tooltip.go-to-okr-unit-overview' | translate }}">
    <mat-icon>home</mat-icon>
  </button>
  <span>{{ 'user-management.user-management-toolbar-title' | translate }}</span>
</app-okr-toolbar>

<div class="container footer-margin">
  <div class="row">
    <mat-card class="col-m-12 col-l-12 col-xl-10 col-s-12 col-centered">
      <mat-card-title>
        <mat-icon>group</mat-icon>
        <span>{{ 'user-management.user-management-toolbar-title' | translate }}</span>
      </mat-card-title>

      <mat-card-content>
        <div class="row">
          <mat-checkbox (change)="onShowDeactivatedUserChange($event)">{{ 'user-management.checkbox' | translate }}</mat-checkbox>
          <mat-form-field class="form-whole-line col-11">
            <input (keyup)="applyFilter($event.target.value)" matInput placeholder="Filter">
          </mat-form-field>
          <button (click)="handleCreate()" class="col-1" color="accent" mat-mini-fab [disabled]="isPlayground">
            <mat-icon [matTooltip]="isPlayground
                        ? 'Neuen Benutzer erstellen ⚠ Deaktiviert in der Demo Version'
                        : 'Neuen Benutzer erstellen'" matTooltip="{{ 'user-management.tooltip.add-new-user' | translate }}">add_circle_outline</mat-icon>
          </button>
          <button (click)="handleCsvImport()" class="col-1" color="accent" mat-mini-fab style="margin-left: 15px" [disabled]="isPlayground">
            <mat-icon [matTooltip]="isPlayground
                        ? 'Benutzer aus CSV importieren ⚠ Deaktiviert in der Demo Version'
                        : 'Benutzer aus CSV importieren'" matTooltip="{{ 'user-management.tooltip.import-users-from-csv' | translate }}">unarchive
            </mat-icon>
          </button>
        </div>

        <ng-container matColumnDef="photo">
            </ng-container><ng-container matColumnDef="active">
            </ng-container><ng-container matColumnDef="email">
            </ng-container><ng-container matColumnDef="givenName">
            </ng-container><ng-container matColumnDef="department" class="cell">
            </ng-container><ng-container matColumnDef="jobTitle">
            </ng-container><ng-container matColumnDef="isAdmin">
            </ng-container><ng-container matColumnDef="actions">
            </ng-container><table [dataSource]="rowData" mat-table matSort matSortActive="active" matSortDirection="desc">
          <tbody><tr><th *matHeaderCellDef mat-header-cell></th>
            <td *matCellDef="let user" mat-cell>
              <app-user-avatar [user]="user" size="38"></app-user-avatar>
            </td>

          <th *matHeaderCellDef mat-header-cell mat-sort-header>{{i18nActiveTableHeader}}</th>
            <td *matCellDef="let user" mat-cell>
              <mat-icon *ngIf="user.active">check</mat-icon>
            </td>

          <th class="hidden-mobile-table" *matHeaderCellDef mat-header-cell mat-sort-header> {{i18nEmailTableHeader}}</th>
            <td class="hidden-mobile-table" *matCellDef="let user" mat-cell>{{user.email}}</td>

          <th *matHeaderCellDef mat-header-cell mat-sort-header> {{i18nNameTableHeader}}</th>
            <td *matCellDef="let user" mat-cell class="name-column" matTooltip="{{user.givenName + ' ' + user.surname}}">{{user.givenName + ' ' + user.surname}}</td>

          <th class="hidden-mobile-table" *matHeaderCellDef mat-header-cell mat-sort-header> {{i18nDepartentTableHeader}}</th>
            <td class="hidden-mobile-table" *matCellDef="let user" mat-cell>{{user.department}}</td>

          <th class="hidden-mobile-table" *matHeaderCellDef mat-header-cell mat-sort-header> {{i18nJobTitleTableHeader}}</th>
            <td class="hidden-mobile-table" *matCellDef="let user" mat-cell>{{user.jobTitle}}</td>

          <th class="hidden-mobile-table" *matHeaderCellDef mat-header-cell mat-sort-header> {{i18nAdminTableHeader}}</th>
            <td class="hidden-mobile-table" *matCellDef="let user" mat-cell>
              <mat-icon *ngIf="user.isAdmin">verified_user</mat-icon>
            </td>

          <th *matHeaderCellDef mat-header-cell></th>
            <td *matCellDef="let user" mat-cell>
              <button (click)="handleEdit(user)" mat-icon-button matTooltip="{{ 'user-management.tooltip.edit-user' | translate }}">
                <mat-icon>edit</mat-icon>
              </button>
              <button (click)="handleDeactivate(user)" *ngIf="currentUser$.getValue().id !== user.id && user.active" mat-icon-button [matTooltip]="isPlayground
                        ? 'Benutzer deaktivieren ⚠ Deaktiviert in der Demo Version'
                        : 'Benutzer deaktivieren'" [disabled]="isPlayground" matTooltip="{{ 'user-management.tooltip.deactivate-user' | translate }}">
                <mat-icon>delete</mat-icon>
              </button>
              <button (click)="handleActivate(user)" *ngIf="currentUser$.getValue().id !== user.id && !user.active" mat-icon-button matTooltip="{{ 'user-management.tooltip.activate-user' | translate }}">
                <mat-icon>restore_from_trash</mat-icon>
              </button>
            </td>


          </tr><tr *matHeaderRowDef="columnsToDisplay;" mat-header-row></tr>
          <tr *matRowDef="let myRowData; columns: columnsToDisplay" mat-row></tr>
        </tbody></table>

        <mat-paginator [pageSizeOptions]="[10,20,25,50,100]" pageSize="25"></mat-paginator>
      </mat-card-content>
    </mat-card>
  </div>
</div>
